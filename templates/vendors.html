{% extends "layout_accounting.html" %}
{% block content %}
<h2>Manage Vendors</h2>

<!-- Add Vendor Form -->
<div class="card mb-4">
    <div class="card-header">
        <h5>Add New Vendor</h5>
    </div>
    <div class="card-body">
        <form method="post" action="{{ url_for('vendors_route') }}">
            <div class="mb-3">
                <label for="vendor_name" class="form-label">Vendor Name</label>
                <input type="text" class="form-control" id="vendor_name" name="vendor_name" required>
            </div>
            <div class="mb-3">
                <label for="vendor_phone" class="form-label">Phone Number</label>
                <input type="tel" class="form-control" id="vendor_phone" name="vendor_phone">
            </div>
            <div class="mb-3">
                <label for="vendor_email" class="form-label">Email</label>
                <input type="email" class="form-control" id="vendor_email" name="vendor_email">
            </div>
            <div class="mb-3">
                <label for="vendor_address" class="form-label">Address</label>
                <textarea class="form-control" id="vendor_address" name="vendor_address" rows="2"></textarea>
            </div>
            <div class="mb-3">
                <label for="vendor_payment" class="form-label">Payment Terms</label>
                <select class="form-select" id="vendor_payment" name="vendor_payment">
                    <option value="cash" selected>Cash</option>
                    <option value="transfer">Transfer</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Add Vendor</button>
        </form>
    </div>
</div>

<!-- Vendors List -->
<div class="card">
    <div class="card-header">
        <h5>All Vendors</h5>
    </div>
    <div class="card-body">
        {% if vendors %}
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Phone</th>
                        <th>Email</th>
                        <th>Contact Person</th>
                        <th>Payment Terms</th>
                        <th>Current Balance</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for vendor in vendors %}
                    <tr>
                        <td>{{ vendor['name'] }}</td>
                        <td>{{ vendor['phone_number'] or 'N/A' }}</td>
                        <td>{{ vendor['email'] or 'N/A' }}</td>
                        <td>{{ vendor['contact_person'] or 'N/A' }}</td>
                        <td>{{ vendor['payment_terms'] or 'N/A' }}</td>
                        <td>â‚¦{{ "%.2f"|format(vendor['current_balance'] or 0) }}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="editVendor('{{ vendor['id'] }}')">Edit</button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteVendor('{{ vendor['id'] }}')">Delete</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-muted">No vendors found. Add your first vendor above.</p>
        {% endif %}
    </div>
</div>

<script>
function validateAndSubmit() {
    const name = document.getElementById('name').value.trim();
    const phone = document.getElementById('phone_number').value.trim();
    const email = document.getElementById('email').value.trim();
    const address = document.getElementById('address').value.trim();
    const contactPerson = document.getElementById('contact_person').value.trim();
    
    console.log('Vendor form validation - Name:', name, 'Phone:', phone, 'Email:', email, 'Address:', address, 'Contact Person:', contactPerson);
    
    if (!name) {
        alert('Vendor name is required!');
        return false;
    }
    
    showLoading();
    return true;
}

function showLoading() {
    document.getElementById("submit-btn").disabled = true;
    document.getElementById("button-text").style.display = "none";
    document.getElementById("loading-spinner").style.display = "inline-block";
}

function deleteVendor(vendorId) {
    if (confirm('Are you sure you want to delete this vendor? This action cannot be undone.')) {
        // Create a form and submit it
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/delete-vendor/${vendorId}`;
        document.body.appendChild(form);
        form.submit();
    }
}

function editVendor(vendorId) {
    window.location.href = `/edit-vendor/${vendorId}`;
}
</script>
{% endblock %}
