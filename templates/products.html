{% extends "layout_accounting.html" %}
{% block content %}
<h2>Manage Products</h2>

<!-- Add Product Form -->
<div class="card mb-4">
    <div class="card-header">
        <h5>Add New Product</h5>
    </div>
    <div class="card-body">
        <form method="post" action="{{ url_for('products_route') }}">
            <div class="mb-3">
                <label for="product_name" class="form-label">Product Name</label>
                <input type="text" class="form-control" id="product_name" name="product_name" required>
            </div>
            <div class="mb-3">
                <label for="product_category" class="form-label">Category</label>
                <select class="form-select" id="product_category" name="product_category">
                    <option value="ponmo" selected>Ponmo</option>
                    <option value="raw_materials">Raw Materials</option>
                    <option value="processing">Processing</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="product_wholesale" class="form-label">Wholesale Price (Owo) - ₦</label>
                <input type="number" class="form-control" id="product_wholesale" name="product_wholesale" step="0.01" required>
            </div>
            <div class="mb-3">
                <label for="product_retail" class="form-label">Retail Price (Piece) - ₦</label>
                <input type="number" class="form-control" id="product_retail" name="product_retail" step="0.01" required>
            </div>
            <div class="mb-3">
                <label for="product_unit" class="form-label">Unit of Measure</label>
                <select class="form-select" id="product_unit" name="product_unit">
                    <option value="piece" selected>Piece</option>
                    <option value="kg">Kilogram</option>
                    <option value="lb">Pound</option>
                    <option value="dozen">Dozen</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="product_description" class="form-label">Description</label>
                <textarea class="form-control" id="product_description" name="product_description" rows="2"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Add Product</button>
        </form>
    </div>
</div>

<!-- Products List -->
<div class="card">
    <div class="card-header">
        <h5>All Products</h5>
    </div>
    <div class="card-body">
        {% if products %}
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Category</th>
                        <th>Wholesale Price</th>
                        <th>Retail Price</th>
                        <th>Unit</th>
                        <th>Description</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in products %}
                    <tr>
                        <td>{{ product['name'] }}</td>
                        <td>{{ product['category'] or 'N/A' }}</td>
                        <td>₦{{ "%.2f"|format(product['wholesale_price'] or 0) }}</td>
                        <td>₦{{ "%.2f"|format(product['retail_price'] or 0) }}</td>
                        <td>{{ product['unit_of_measure'] or 'N/A' }}</td>
                        <td>{{ product['description'] or 'N/A' }}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="editProduct('{{ product['id'] }}')">Edit</button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteProduct('{{ product['id'] }}')">Delete</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-muted">No products found. Add your first product above.</p>
        {% endif %}
    </div>
</div>

<script>
function showLoading() {
    document.getElementById("submit-btn").disabled = true;
    document.getElementById("button-text").style.display = "none";
    document.getElementById("loading-spinner").style.display = "inline-block";
}

function editProduct(productId) {
    // TODO: Implement edit functionality
    alert('Edit functionality coming soon!');
}

function deleteProduct(productId) {
    if (confirm('Are you sure you want to delete this product? This action cannot be undone.')) {
        // Create a form and submit it
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/delete-product/${productId}`;
        document.body.appendChild(form);
        form.submit();
    }
}

function editProduct(productId) {
    window.location.href = `/edit-product/${productId}`;
}
</script>
{% endblock %}
